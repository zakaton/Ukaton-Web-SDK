<html>
  <head>
    <title>Ready Player Me Pro | Ukaton</title>
    <link
      rel="icon"
      href="https://cdn.glitch.com/024019a9-317f-4462-b4f9-7674047a399c%2Fukaton_no_text_low.png?v=1595095184886"
    />

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>

    <script src="/BaseMission.js"></script>
    <script src="/BluetoothMissionDevice.js"></script>
    <script src="/PeerBluetoothMissionDevice.js"></script>
    <script src="/WebSocketMissionDevice.js"></script>
    <script src="/body-tracking/hand-tracking-controls-proxy.js"></script>
    <script src="/body-tracking/follow-shadow.js"></script>
    <script src="/body-tracking/ready-player-me-pro.js"></script>
    <!-- https://github.com/gftruj/aframe-hand-tracking-controls-extras -->
    <script src="https://gftruj.github.io/hand.tracking.controls.extras/dist/aframe-hand-tracking-controls-extras.js"></script>
  </head>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }
    #overlay {
      position: absolute;
      z-index: 1;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    #overlay .clickable {
      pointer-events: all;
    }
    #overlay .hidden {
      display: none;
    }
  </style>
  <body>
    <div id="overlay">
      <button class="clickable" onclick="connect()">
        connect via WebSockets
      </button>
      <button class="clickable" onclick="calibrate()">Calibrate</button>
      <button class="clickable" onclick="addBluetoothDevice()">
        add bluetooth device
      </button>
      <button
        class="clickable"
        onclick="navigator.clipboard.writeText('ws://192.168.4.52, ws://192.168.4.53, ws://192.168.4.54, ws://192.168.4.55, ws://192.168.4.56, ws://192.168.4.57, ws://192.168.4.58, ws://192.168.4.59, ws://192.168.4.60, ws://192.168.4.61, ws://192.168.6.11, ws://192.168.6.12')"
      >
        copy gateways
      </button>
    </div>
    
    <!-- https://medium.com/samsung-internet-dev/integrating-augmented-reality-objects-into-the-real-world-with-light-and-shadows-12123e7b1151 -->
    <a-scene
      webxr
      shadow="type: pcfsoft"
      renderer="physicallyCorrectLights:true; colorManagement:true; exposure:1; toneMapping:ACESFilmic;"
    >
      <!-- view-source:https://webxr-networked-handtracking.glitch.me/scene.html -->

      <a-light
        id="real-light"
        type="directional"
        light="castShadow:true;shadowCameraAutomatic:#objects;"
        position="1 2 1"
        intensity="3"
      ></a-light>

      <a-camera id="camera" position="0 1.6 1"></a-camera>

      <a-entity
        id="leftHandTrackingControls"
        hand-tracking-controls="hand: left;"
        hand-tracking-extras
      ></a-entity>
      <a-entity
        id="rightHandTrackingControls"
        hand-tracking-controls="hand: right;"
        hand-tracking-extras
      ></a-entity>

      <a-entity
        id="leftHandControls"
        hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"
      ></a-entity>
      <a-entity
        id="rightHandControls"
        hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"
      ></a-entity>

      <!--
      <a-entity position="0 0 -2"
        ><a-entity hand-tracking-controls-proxy="hand: left; source: #leftHand"></a-entity>
        <a-entity hand-tracking-controls-proxy="hand: right;  source: #rightHand"></a-entity
      ></a-entity>
      -->

      <a-entity
        id="rig"
        position="0 0 -1"
        gltf-model="https://cdn.glitch.global/6c283599-191e-4c4a-b236-e1e1f0d90e7a/avatar.glb?v=1646356912673"
        ready-player-me="gateway: 192.168.4.52, 192.168.4.53, 192.168.4.54, 192.168.4.55, 192.168.4.56, 192.168.4.57, 192.168.4.58, 192.168.4.59, 192.168.4.60, 192.168.4.61, 192.168.6.11, 192.168.6.12; leftHandTrackingControls: #leftHandTrackingControls; rightHandTrackingControls: #rightHandTrackingControls; leftHandControls: #leftHandControls; rightHandControls: #rightHandControls; camera: #camera"
        shadow
      ></a-entity>
      <a-plane
        id="shadow-plane"
        follow-shadow="#rig"
        material="shader:shadow"
        shadow="cast:false;"
        rotation="-90 0 0"
        width="10"
        height="10"
      ></a-plane>
    </a-scene>
  </body>
  <script>
    const rig = document.getElementById("rig");
    function connect() {
      rig.emit("connect");
    }
    function calibrate() {
      rig.emit("calibrate", { delay: 0000 });
    }
    function addBluetoothDevice() {
      rig.emit("addbluetoothdevice");
    }

    const scene = document.querySelector("a-scene");
    const overlay = document.getElementById("overlay");
  </script>
</html>
