<html>
  <head>
    <title>Shoe | Ukaton Side Missions</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
    <script src="/MissionMesh.js"></script>
  </head>
  <body>
    <a-scene renderer="colorManagement: true;">
      <a-assets>
        <a-asset-item
          id="shoeModel"
          src="https://cdn.glitch.me/6c283599-191e-4c4a-b236-e1e1f0d90e7a%2Fshoe%20model.glb?v=1635624986582"
        ></a-asset-item>
      </a-assets>

      <a-camera
        look-controls="enabled: false;"
        orbit-controls="target: 0 0 0; initialPosition: -2 0 0"
      ></a-camera>

      <a-light type="ambient" target="#shoe" intensity="0.1"></a-light>
      <a-light
        type="directional"
        position="1 1 0"
        target="#shoe"
        intensity="0.2"
      ></a-light>
      <a-light type="hemisphere" target="#shoe"></a-light>

      <a-entity id="shoe">
        <a-entity scale="10 10 10">
          <a-entity rotation="-7.000 92.07 11.210">
            <a-entity position="-0.009 0.010 0.116">
              <a-entity gltf-model="#shoeModel"></a-entity>
            </a-entity>
          </a-entity>
        </a-entity>
      </a-entity>

      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      const shoe = document.getElementById("shoe");
      const missionMesh = new MissionMesh();

      let device;
      missionMesh.addEventListener("deviceadded", event => {
        device = event.message.device;
        device.addEventListener("quaternion", event => {
          const { quaternion } = event.message;
          shoe.object3D.quaternion.copy(quaternion);
        });
        device.setMotionConfiguration({ quaternion: 40 });
      });

      const connect = () => {
        missionMesh.connect("ws://192.168.5.202/ws");
      };
    </script>
  </body>
</html>
